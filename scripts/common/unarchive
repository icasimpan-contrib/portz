#!/bin/bash

#
# this script unarchives package to some current directory
#
archive_file="$1"

. ${portz_root}/scripts/defs.sh

portz_unzip()
{
    if which unzip > /dev/null; then
        portz_invoke_always unzip $*
    else
        inform "using bundled unzip"
        portz_invoke_always $portz_tools/unzip/unzip $*
    fi
} 

TAR_COMMON_OPTIONS="--no-overwrite-dir --atime-preserve -m --no-same-owner --no-same-permissions"
case ${archive_file} in
    *.tar)     portz_invoke_always ${TAR} x ${TAR_COMMON_OPTIONS} -f ${archive_file} ;;
    *.tar.gz)  portz_invoke_always ${TAR} zx ${TAR_COMMON_OPTIONS} -f ${archive_file} ;;
    *.tgz)     portz_invoke_always ${TAR} zx ${TAR_COMMON_OPTIONS} -f ${archive_file} ;; 
    *.tar.bz2) portz_invoke_always ${TAR} jx ${TAR_COMMON_OPTIONS} -f ${archive_file} ;;
    *.tbz)     portz_invoke_always ${TAR} jx ${TAR_COMMON_OPTIONS} -f ${archive_file} ;;
    *.txz)     portz_invoke_always ${TAR} Jx ${TAR_COMMON_OPTIONS} -f ${archive_file} ;;
    *.tar.xz)  portz_invoke_always ${TAR} Jx ${TAR_COMMON_OPTIONS} -f ${archive_file} ;;
    *.zip)     portz_unzip ${archive_file} ;;
    *.tar.lzma) portz_invoke_always ${TAR} x --lzma -f ${archive_file} ;;
    # TODO, add lzma
    *) fail "unknown archive type: ${archive_file} (supported tar (gz,bz2) and zip"
esac

